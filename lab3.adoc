:diagram-use-plantuml:
:author: Залипаева Эвелина КЭ-201
:icon: front
:secttrue: true
:toc: left
:toclevels: 2
:secttruelevels: 2
:sectnums: |,all|
:stylesheet: custom.css
:stylesdir: ./styles
:imagesdir: pic
:toc:
:toc-title: Оглавление
:figure-caption: Рисунок
:table-caption: Таблица

include::test.adoc[]

== Что такое прерывание?

* Процессор работает как обычно
* Вдруг происходит событие (нажатие клавиши, таймер и т.д.)
* Процессор *срочно* откладывает текущую задачу
* Выполняет специальную программу (обработчик прерывания)
* Возвращается к прерванной работе

== Какие бывают прерывания?
– Аппаратные (асинхронные)::  
   * кнопки
   * датчики
   * таймеры
– Синхронные (исключения)::  
  Возникают внутри ядра — деление на ноль, неправильная инструкция, обращение к запрещенной памяти.

– Программные::  
  Вызываются явно из кода специальной командой (например, `SVC`).

Аппаратные IRQ-линии делятся на:

* Маскируемые — их можно включать/выключать через контроллер прерываний NVIC.
* Немаскируемые (NMI) — всегда проходят, даже если другие отключены (например, при сбое питания).

== Что происходит при прерывании?
. Завершает текущую инструкцию и сохраняет часть регистров на стек.
. Проверяет в NVIC, разрешено ли это прерывание и какой у него приоритет.
. Берёт из таблицы векторов адрес функции-обработчика и прыгает туда.
. По окончании ISR восстанавливает контекст и продолжает выполнение основной программы.

== Важные особенности:
. Каждое прерывание имеет свой уровень важности (приоритет)
. Если пришло более важное прерывание:
   * Текущее прерывание ставится на паузу
   * Выполняется более важное
   * Потом возвращаемся к прерванному
   * Одинаковые приоритеты не прерывают друг друга
   * Критичные прерывания (типа HardFault) всегда самые важные

== NVIC - это "диспетчер прерываний" в ARM-процессорах

1. *Что делает*:
   - Решает, какое прерывание важнее (приоритеты)
   - Включает/выключает прерывания
   - Отправляет процессору сигнал о прерывании

2. *Как работает*:
   - Есть таблица прерываний (каждому свой номер)
   - Для каждого прерывания можно:
     • Включить/выключить
     • Задать приоритет (0-255)
     • Указать обработчик

3. *Плюсы*:
   - Быстрая реакция (нет лишних проверок)
   - Можно делать "прерывания в прерываниях" (вложенные)
   - Экономит энергию (можно отключать ненужные)

== Таблица векторов прерываний 
Таблица векторов прерываний (Interrupt Vector Table, IVT) в STM32 - это структура данных, которая содержит адреса функций обработчиков прерываний. Каждый вектор в таблице соответствует определенному прерыванию и указывает на функцию, которая будет выполнена при возникновении этого прерывания. 

== Что такое обработчик прерываний, как правильно обрабатывать прерывание.

=== Что это?
• Это функция, которую процессор вызывает при прерывании

=== Как правильно обрабатывать:
*Быстро*

   - Делать только самое необходимое
   - Долгие задачи оставлять для основной программы

*Безопасно*

   - Сохранить все регистры в начале (если нужно)
   - Не вызывать сложные функции 
   - Не делать бесконечных циклов

*Четко*

   - Определить причину прерывания
   - Обработать данные от устройства
   - Сбросить флаг прерывания


